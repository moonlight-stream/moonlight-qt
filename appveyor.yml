version: 0.0.0.{build}

# Steam Link only builds on Ubuntu 16.04, and Github Actions runners don't go that far back.
# All other builds are now in .github/workflows/ci.yml

clone_depth: 1

environment:
  matrix: []
    - APPVEYOR_BUILD_WORKER_IMAGE: Ubuntu1604
      BUILD_TARGET: steamlink

install:
  - sh: '[ "$BUILD_TARGET" != steamlink ] || sudo apt install -y libc6:i386 libstdc++6:i386'
  - sh: '[ "$BUILD_TARGET" != steamlink ] || git clone --depth=1 https://github.com/ValveSoftware/steamlink-sdk.git $HOME/steamlink-sdk'

before_build:
  - sh: 'git -c submodule.libs.update=none submodule update --init --recursive'
  - sh: 'export VERSION=`cat app/version.txt`'

build_script:
  - sh: '[ "$BUILD_TARGET" != steamlink ] || STEAMLINK_SDK_PATH=$HOME/steamlink-sdk scripts/build-steamlink-app.sh'

after_build:
  - sh: '[ "$BUILD_TARGET" != steamlink ] || appveyor PushArtifact build/installer-release/Moonlight-SteamLink-$VERSION.zip -FileName Moonlight-SteamLink-r$APPVEYOR_BUILD_NUMBER.zip'

deploy: off
